================================================================
  Meme Scanner Bot  使い方・設定ガイド
================================================================
  Solana ミームコインをスキャンして、高スコアのシグナルを
  Telegram に通知する Bot です。
  APIキー不要・完全無料で動作します。
================================================================


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  目次
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  1. 初回セットアップ
  2. 起動方法
  3. Telegram コマンド一覧
  4. 通知メッセージの見方
  5. スコアの仕組み
  6. config.py の設定項目一覧
  7. シグナルログ（signal_log.csv）の使い方
  8. Claude による設定最適化の手順
  9. 通知が来ないときの確認手順
  10. ファイル構成
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


================================================================
  1. 初回セットアップ
================================================================

【必要なもの】
  - Python 3.9 以上
  - Telegram アカウント
  - Telegram Bot トークン（BotFather から取得）
  - Telegram チャット ID（userinfobot から取得）

【手順】

  Step 1: セットアップスクリプトを実行する
    ターミナルで以下を実行:

      bash /Users/shionueta/Project/Scalping_bot/meme_scanner/setup.sh

    → 仮想環境（.venv）の作成と必要パッケージのインストールが行われる。
    → .env ファイルが自動生成される。

  Step 2: Telegram の設定を入力する
    生成された .env ファイルを編集:

      nano /Users/shionueta/Project/Scalping_bot/meme_scanner/.env

    以下の2行を記入して保存（Ctrl+O → Enter → Ctrl+X）:

      TELEGRAM_TOKEN=xxxxxxxxxx:xxxxxxxxxxxxxxxxxxxxxxxxxx
      TELEGRAM_CHAT_ID=123456789

    ▼ TELEGRAM_TOKEN の取得方法
      1. Telegram で「@BotFather」を検索して開く
      2. /newbot を送信
      3. Bot の名前とユーザー名を入力
      4. 発行されたトークンをコピーして貼り付ける

    ▼ TELEGRAM_CHAT_ID の取得方法
      1. Telegram で「@userinfobot」を検索して開く
      2. 何かメッセージを送ると「Id: 123456789」のように表示される
      3. その数字をコピーして貼り付ける

  Step 3: 起動する（次のセクション参照）

----------------------------------------------------------------


================================================================
  2. 起動方法
================================================================

【方法A】アプリをダブルクリックして起動（推奨）
  Finder で以下のファイルをダブルクリック:
    meme_scanner.app

  → Terminal が自動で開き、ログがリアルタイムで表示される。

  ※ 初回のみ「開発元を確認できない」と表示される場合の対処:
    右クリック → 「開く」→「開く」をクリック
    または、ターミナルで以下を実行:
      xattr -cr /Users/shionueta/Project/Scalping_bot/meme_scanner/meme_scanner.app

【方法B】ターミナルから起動
  ターミナルで以下を実行:

    bash /Users/shionueta/Project/Scalping_bot/meme_scanner/start.sh

  → ログが画面に流れる。Ctrl+C で停止。

【起動後にすること】
  Telegram で自作 Bot に以下を送信:

    /start    ← 自動スキャン開始（これを送るまでスキャンしない）

  Bot を起動しただけでは自動スキャンは始まらない。
  /start を送って初めてスキャンが動き出す。

【ログを別ターミナルで確認したい場合（バックグラウンド実行時）】
    bash /Users/shionueta/Project/Scalping_bot/meme_scanner/logs.sh

【.app を作り直したい場合（プロジェクトを移動した後など）】
    bash /Users/shionueta/Project/Scalping_bot/meme_scanner/create_app.sh

----------------------------------------------------------------


================================================================
  3. Telegram コマンド一覧
================================================================

  コマンドは Telegram の Bot チャット画面から送信する。

  ┌─────────────────────────────────────────────────────────┐
  │  基本操作                                               │
  ├──────────────┬──────────────────────────────────────────┤
  │ /start       │ 自動スキャン開始（設定間隔ごとに繰り返す）│
  │ /stop        │ 自動スキャンを停止する                   │
  │ /scan        │ 今すぐ1回スキャンを実行する              │
  │ /status      │ 現在の設定・稼働状況を表示する           │
  │ /help        │ コマンド一覧とヘルプを表示する           │
  └──────────────┴──────────────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────┐
  │  設定変更（Bot 稼働中でもリアルタイムに反映される）      │
  ├──────────────────────┬──────────────────────────────────┤
  │ /threshold <点数>    │ 通知するスコアの閾値を変更        │
  │ /setmc <最小> <最大> │ スキャン対象の MC レンジを変更   │
  │ /setinterval <間隔>  │ 自動スキャンの間隔を変更         │
  └──────────────────────┴──────────────────────────────────┘

【/threshold の使い方】
  スコアがこの点数以上のコインだけ通知される。

  /threshold 70    → 70点以上を通知（デフォルト）
  /threshold 80    → 80点以上のみ通知（厳選）
  /threshold 60    → 60点以上を通知（緩め）

【/setmc の使い方】
  スキャンする時価総額（MC）の範囲を変更する。
  K（千ドル）・M（百万ドル）単位で指定できる。

  /setmc 500K 50M      → $500K〜$50M（デフォルト）
  /setmc 1M 10M        → $1M〜$10M に絞る
  /setmc 300000 5000000 → 数値でも指定可

【/setinterval の使い方】
  自動スキャンの実行間隔を変更する。
  稼働中でも変更すると即座に次のサイクルから反映される。
  最低 60秒。

  /setinterval 300     → 300秒（5分）ごと（デフォルト）
  /setinterval 5m      → 5分ごと（上と同じ）
  /setinterval 10m     → 10分ごと
  /setinterval 60      → 60秒ごと（最短）

【/logsummary の使い方】
  蓄積されたシグナルログの統計サマリーを表示する。
  スキャン実績・勝率・平均損益率を確認できる。

  /logsummary    → サマリーを表示

  表示される内容:
    総記録数     … これまでにスコア計算したシグナルの総数
    未確認       … まだ60分後の結果が記録されていないシグナル数
    確認済み     … WIN/LOSS などの結果が記録済みのシグナル数
    勝率         … WIN + WIN+ の割合
    通知済み     … 閾値を超えて Telegram に通知したシグナル数
    通知後の勝率 … 通知したシグナルだけの勝率（最も重要な指標）
    平均スコア   … 全シグナルの平均スコア
    平均損益率   … 60分後の平均損益（プラスなら設定が有効に機能している）

----------------------------------------------------------------


================================================================
  4. 通知メッセージの見方
================================================================

  通知が届いたときのメッセージの読み方。

  ┌──────────────────────────────────────┐
  │ 🚨 ミームコインアラート 🚨           │
  │                                      │
  │ 🪙 SYMBOL (コイン名)                 │
  │ 🔗 Solana  |  📦 MC帯: $1M〜$5M     │
  │ 📊 スコア: 78/100                    │
  │                                      │
  │ ━━━━━━━━━━━━━━━                      │
  │ 📈 スコア内訳                        │
  │   出来高急増:  20/25  (×3.5 / 閾値×3.0)  │
  │   VWAP上抜け: 20/20                  │
  │   RSI(9):     20/20  (RSI: 62.3)    │
  │   流動性:     12/15                  │
  │   再現性:     16/20  (8/10回成功)    │
  │   過熱ペナル:  0/−15                 │
  │                                      │
  │ ━━━━━━━━━━━━━━━                      │
  │ 💰 現在価格:  $0.00012345           │
  │ 📉 損切り:    $0.00011234  (ATR×2.0)│
  │ 📈 利確目標:  $0.00017345  (ATR×5.0)│
  │ ⚖️  RR比:     1:2.5                  │
  │ 📐 ATR:       $0.00000555           │
  │ 📊 VWAP:      $0.00011800           │
  │                                      │
  │ ━━━━━━━━━━━━━━━                      │
  │ 💧 流動性:   $45,000               │
  │ 📦 MC:       $2,500,000            │
  │ 🕐 1h出来高: $120,000              │
  └──────────────────────────────────────┘

  【各項目の意味】

  スコア内訳:
    出来高急増  … 直近出来高が過去平均の何倍か（最大25点）
    VWAP上抜け … 現在価格が当日VWAP（平均コスト）を上回るか（20点）
    RSI(9)     … モメンタム指標。50超でポジティブ（最大20点）
    流動性     … プールの流動性が高いほど高得点（最大15点）
    再現性     … 過去に同じシグナルが出たとき上昇した確率（最大20点）
    過熱ペナル … RSIが過熱閾値を超えると減点（最大−15点）

  価格情報:
    現在価格   … エントリーする場合の基準価格
    損切り     … 現在価格 − ATR × 倍率（MC帯別）
    利確目標   … 現在価格 + ATR × 倍率（MC帯別）
    RR比       … リスクリワード比（1:2.5 なら損1に対して利益2.5）
    ATR        … 平均的な価格の振れ幅（ボラティリティの目安）
    VWAP       … 当日の出来高加重平均価格

  ⚠️ サンプル少 … 再現性の計算に使ったシグナルが5回未満。
                   統計的な信頼性が低いため参考程度に。

----------------------------------------------------------------


================================================================
  5. スコアの仕組み
================================================================

  【配点（100点満点）】

    項目          配点   説明
    ──────────────────────────────────────────────────────
    出来高急増     25点   直近出来高 ÷ 過去20本平均 が閾値倍以上
    VWAP上抜け    20点   終値 > VWAP で満点
    RSI(9)        20点   50 < RSI ≤ 過熱閾値 で満点
    流動性         15点   流動性 $50K 以上で満点
    再現性         20点   過去シグナルの上昇成功率 50% 以上で満点
    過熱ペナルティ −15点  RSIが過熱閾値を超えると減点
    ──────────────────────────────────────────────────────
    合計（最大）  100点

  【MC帯ごとの違い】
    MC が小さいほど値動きが激しいため、
    出来高急増の閾値・RSI 過熱閾値・損切り幅が大きく設定されている。

    帯              MC範囲       出来高閾値  RSI過熱  足の時間軸
    ─────────────────────────────────────────────────────────
    超マイクロキャップ $300K〜$1M   ×5倍以上    91超     5分足
    スモールキャップ   $1M〜$5M    ×3倍以上    87超    10分足
    ミッドキャップ     $5M〜$50M   ×2倍以上    82超    15分足

  【再現性スコアの計算方法】
    直近100本のローソク足で「シグナル発生後 60分以内に ATR×0.7 以上
    上昇したか」を検証し、成功率からスコアを算出する。

    成功率 50% 以上  → 20点（満点）
    成功率 25〜50%  → 線形補間（0〜20点）
    成功率 25% 未満 → 0点

----------------------------------------------------------------


================================================================
  6. config.py の設定項目一覧
================================================================

  ファイルの場所:
    /Users/shionueta/Project/Scalping_bot/meme_scanner/config.py

  編集方法:
    nano /Users/shionueta/Project/Scalping_bot/meme_scanner/config.py
    （Ctrl+O で保存、Ctrl+X で閉じる）

  変更を反映するには Bot を再起動する（Ctrl+C → start.sh）。
  ※ /setmc・/threshold・/setinterval で変更した項目は
    Bot を再起動すると config.py の初期値に戻る。

  ┌─────────────────────────────────────────────────────────────────┐
  │  基本フィルター設定                                             │
  ├──────────────────┬──────────┬──────────────────────────────────┤
  │ 設定項目         │ 初期値   │ 説明                             │
  ├──────────────────┼──────────┼──────────────────────────────────┤
  │ MC_MIN           │ 500_000  │ スキャン対象の最低MC（$）        │
  │ MC_MAX           │50_000_000│ スキャン対象の最高MC（$）        │
  │ LIQ_MIN          │ 10_000   │ 最低流動性フィルター（$）        │
  │ SCAN_INTERVAL    │ 300      │ 自動スキャン間隔（秒）           │
  │ NOTIFY_THRESHOLD │ 70       │ 通知するスコアの閾値（点）       │
  │ NOTIFY_TTL       │ 3600     │ 同一トークンの再通知抑制時間（秒）│
  ├──────────────────┼──────────┼──────────────────────────────────┤
  │  指標パラメータ                                                 │
  ├──────────────────┼──────────┼──────────────────────────────────┤
  │ RSI_PERIOD       │ 9        │ RSI の計算期間（本数）           │
  │ ATR_PERIOD       │ 14       │ ATR の計算期間（本数）           │
  │ OHLCV_LIMIT      │ 100      │ 取得するローソク足の本数         │
  └──────────────────┴──────────┴──────────────────────────────────┘

  ┌─────────────────────────────────────────────────────────────────┐
  │  MC帯別パラメータ（MC_BAND_PARAMS）                             │
  ├─────────────────────┬──────────────────────────────────────────┤
  │ 設定項目            │ 説明                                     │
  ├─────────────────────┼──────────────────────────────────────────┤
  │ mc_min / mc_max     │ この帯が適用される MC の範囲（$）        │
  │ rsi_overbought      │ RSI 過熱判定の閾値（超えるとペナルティ） │
  │ atr_sl_mult         │ 損切り幅 = ATR × この値                  │
  │ atr_tp_mult         │ 利確幅   = ATR × この値                  │
  │ volume_surge_min    │ 出来高急増とみなす倍率の閾値             │
  │ ohlcv_aggregate     │ 使用するローソク足の時間軸（分）         │
  └─────────────────────┴──────────────────────────────────────────┘

  【MC帯パラメータの現在の設定値】

    帯1（$300K〜$1M）:
      rsi_overbought  = 91    （RSI 91 超でペナルティ）
      atr_sl_mult     = 2.5   （損切り = ATR × 2.5）
      atr_tp_mult     = 6.5   （利確   = ATR × 6.5）
      volume_surge_min= 5.0   （出来高 5倍以上で急増判定）
      ohlcv_aggregate = 5     （5分足）

    帯2（$1M〜$5M）:
      rsi_overbought  = 87    （RSI 87 超でペナルティ）
      atr_sl_mult     = 2.0   （損切り = ATR × 2.0）
      atr_tp_mult     = 5.0   （利確   = ATR × 5.0）
      volume_surge_min= 3.0   （出来高 3倍以上で急増判定）
      ohlcv_aggregate = 10    （10分足）

    帯3（$5M〜$50M）:
      rsi_overbought  = 82    （RSI 82 超でペナルティ）
      atr_sl_mult     = 1.75  （損切り = ATR × 1.75）
      atr_tp_mult     = 4.0   （利確   = ATR × 4.0）
      volume_surge_min= 2.0   （出来高 2倍以上で急増判定）
      ohlcv_aggregate = 15    （15分足）

  【チューニングの方向性】

    通知が多すぎる場合:
      → NOTIFY_THRESHOLD を上げる（例: 70 → 80）
      → volume_surge_min を上げる（急増判定を厳しくする）

    通知が少なすぎる場合:
      → NOTIFY_THRESHOLD を下げる（例: 70 → 60）
      → volume_surge_min を下げる（急増判定を緩める）
      → MC_MIN / MC_MAX を広げる

    損切りがすぐ引っかかる場合:
      → atr_sl_mult を大きくする（例: 2.0 → 2.5）

    利確に届かない場合:
      → atr_tp_mult を小さくする（例: 5.0 → 3.5）

----------------------------------------------------------------


================================================================
  7. シグナルログ（signal_log.csv）の使い方
================================================================

  Bot が稼働中、スキャンのたびにすべてのシグナルが自動で記録される。
  閾値未満で通知しなかったものも含め、全ペアが対象。
  60分後にバックグラウンドで値動きを取得し、結果（WIN/LOSS）を自動更新する。

【ファイルの場所】
  /Users/shionueta/Project/Scalping_bot/meme_scanner/signal_log.csv

  Excel または Numbers で直接開ける（UTF-8 BOM 形式）。

【記録される列の一覧】

  ▼ シグナル情報
    signal_id          一意な識別子（8文字）
    signal_time_jst    検出日時（JST）
    symbol             トークンシンボル
    mc_band            MC帯（$300K〜$1M など）
    mc                 時価総額（$）
    liquidity          流動性（$）

  ▼ 価格・指標
    entry_price        エントリー価格（検出時の終値）
    sl_price           損切り価格
    tp_price           利確目標価格
    rr_ratio           リスクリワード比
    atr                ATR（ボラティリティ指標）
    vwap               VWAP（当日の出来高加重平均価格）
    rsi                RSI(9)の値
    vol_surge          出来高急増倍率

  ▼ スコア内訳
    score_total        合計スコア（0〜100点）
    score_volume       出来高急増スコア（0〜25点）
    score_vwap         VWAP上抜けスコア（0 or 20点）
    score_rsi          RSIスコア（0〜20点）
    score_liquidity    流動性スコア（0〜15点）
    score_repro        再現性スコア（0〜20点）
    score_penalty      過熱ペナルティ（0〜−15点）

  ▼ 再現性の詳細
    signal_count       過去シグナル発生回数
    success_count      うち上昇成功回数
    success_rate       成功率（0.0〜1.0）

  ▼ 適用されたMC帯パラメータ（分析・最適化に使う）
    ohlcv_aggregate    使用した足の時間軸（分）
    rsi_overbought     RSI過熱閾値
    atr_sl_mult        損切り倍率
    atr_tp_mult        利確倍率
    volume_surge_min   出来高急増の判定閾値

  ▼ 通知情報
    notified           Telegramに通知したか（True/False）
    notify_threshold   通知時の閾値設定値

  ▼ 結果（60分後に自動記入）
    outcome_checked_at 結果確認日時（JST）
    price_15m          15分後の価格
    price_30m          30分後の価格
    price_60m          60分後の価格
    high_60m           60分以内の最高値
    low_60m            60分以内の最安値
    sl_hit             SLに到達したか（True/False）
    tp_hit             TPに到達したか（True/False）
    outcome            結果（下表参照）
    pnl_pct            60分後の損益率（%）

【outcome（結果）の値の意味】

  WIN      TP に先着した（利確成功）
  LOSS     SL に先着した（損切り発動）
  WIN+     TP 未到達だが 60分後にプラス（小幅上昇）
  LOSS-    SL 未到達だが 60分後にマイナス（小幅下落）
  BOTH     同一ローソク足で SL・TP 両方到達（判定不能）
  UNKNOWN  データ不足で判定不能
  EXPIRED  シグナルから10時間以上経過してデータ取得を断念
  OPEN     まだ結果確認中（60分未経過）

【結果が自動更新されるタイミング】
  /start で自動スキャンを開始すると、15分ごとに結果確認ジョブが動く。
  シグナルから60分以上経過したものを順番に確認して CSV を更新する。
  /stop すると結果確認ジョブも停止する。

----------------------------------------------------------------


================================================================
  8. Claude による設定最適化の手順
================================================================

  蓄積した signal_log.csv を Claude に分析させることで、
  自分のスキャン結果に最適な config 設定を提案してもらえる。

【手順】

  Step 1: ある程度データを蓄積する
    最低でも 50〜100件のシグナルが記録されてから分析すると精度が高い。
    /logsummary で現在の件数と勝率を確認できる。

  Step 2: signal_log.csv を開く
    Finder で以下のファイルを見つける:
      /Users/shionueta/Project/Scalping_bot/meme_scanner/signal_log.csv

  Step 3: Claude に添付して質問する
    claude.ai（https://claude.ai）を開き、
    signal_log.csv をアップロードしてから以下のように質問する:

    ────────────────────────────────────────────────────
    【そのまま使えるプロンプト例】

    このCSVはSolanaミームコインスキャンBotのシグナルログです。
    各行は1つのシグナルで、60分後の値動き結果（outcome列）が
    記録されています。

    分析の前処理として以下をお願いします:                                                                                 
                                                                                                                        
    1. 同じ token_address で outcome=OPEN の重複行は除外してください                                                      
    2. 同じ token_address の確認済み行（outcome が OPEN 以外）は、                                                        
       最初に記録された行（signal_time_unix が最小の行）のみ残してください
    3. 前処理後の件数も教えてください

    これを踏まえたうえで以下を分析して、最適な設定値を提案してください:

    1. score_total の閾値分析
       どのスコア帯（60点台/70点台/80点台）で
       WIN率が最も高いか教えてください。

    2. MC帯別の勝率分析
       mc_band ごとに WIN率を比較し、
       どの帯が最も成績が良いか教えてください。

    3. スコア内訳と勝率の相関
       score_volume / score_rsi / score_vwap / score_repro の
       各スコアと outcome の関係を分析してください。
       どの指標が勝率に最も影響しているか教えてください。

    4. config.py への提案
       分析結果をもとに以下のパラメータの最適値を提案してください:
       - NOTIFY_THRESHOLD（通知閾値）
       - volume_surge_min（MC帯別）
       - rsi_overbought（MC帯別）
       - atr_sl_mult / atr_tp_mult（MC帯別）
    ────────────────────────────────────────────────────

  Step 4: 提案された値を config.py に反映する
    Claude の提案を参考に config.py を編集し、Bot を再起動する。
    変更前後の勝率を /logsummary で比較して効果を確認する。

【分析の際に役立つ追加の質問例】

  「notified=True のシグナルだけ抽出して勝率を教えて」
  「pnl_pct が高いシグナルに共通する特徴を教えて」
  「RSI と vol_surge の組み合わせでベストなパターンを教えて」
  「score_repro（再現性スコア）が高いほど本当に勝率が上がるか確認して」

【注意事項】

  - OPEN のままのシグナルが多い場合は、もう少し待ってから分析する。
  - サンプルが少ない（50件未満）と分析精度が下がる。
  - outcome=BOTH や UNKNOWN は分析から除外してもらうと精度が上がる。
  - 相場環境（強気/弱気）によって最適値は変わることがある。

----------------------------------------------------------------


================================================================
  9. 通知が来ないときの確認手順
================================================================

  1. /scan を送信してログを見る
     ターミナルに各コインのスコアが表示されるので確認する。

  2. スコアは出ているが通知が来ない場合
     → /threshold で閾値を確認・引き下げる
       例: /threshold 60

  3. スコアが表示されない（スキャン結果が空）場合
     → MCレンジが狭すぎる可能性
       例: /setmc 300K 50M で広げる

  4. 同じコインが繰り返し通知されない場合
     → 重複防止キャッシュが効いている（1時間制限）
       config.py の NOTIFY_TTL を短くするか、Bot を再起動する

  5. ログに「OHLCV データ不足」が多い場合
     → 新しすぎるコインはローソク足が 23本未満でスキップされる
       しばらく待つか、MC レンジを変えて別のコインを対象にする

  6. ログに「プールアドレス取得失敗」が多い場合
     → GeckoTerminal がそのトークンに対応していない
       DexScreener には載っているが GeckoTerminal にない場合に起きる

----------------------------------------------------------------


================================================================
  10. ファイル構成
================================================================

  meme_scanner/
  │
  ├── 使い方・設定ガイド.txt    ← このファイル
  │
  ├── [起動関連]
  │   ├── meme_scanner.app      Finder からダブルクリックで起動するアプリ
  │   ├── start.sh              ターミナルから起動するスクリプト
  │   ├── setup.sh              初回セットアップスクリプト
  │   ├── create_app.sh         meme_scanner.app を作り直すスクリプト
  │   └── logs.sh               バックグラウンド実行中のログ確認スクリプト
  │
  ├── [設定]
  │   ├── config.py             全設定値（MC帯パラメータ含む）★よく触る
  │   ├── .env                  Telegram トークン・チャットID ★触る
  │   └── .env.example          .env のテンプレート
  │
  ├── [ソースコード]
  │   ├── bot.py                Telegram Bot 本体
  │   ├── dex_scanner.py        DexScreener でコインをフィルタリング
  │   ├── gt_fetcher.py         GeckoTerminal で価格データを取得
  │   ├── indicators.py         RSI・ATR・VWAP の計算
  │   ├── reproducibility.py    再現性スコアの計算
  │   ├── scorer.py             スコアリング（全指標を統合）
  │   ├── tracker.py            シグナルログの記録・結果更新
  │   └── cache.py              重複通知防止
  │
  ├── [自動生成ファイル]
  │   ├── signal_log.csv        シグナルログ（★Claude 分析に使う）
  │   └── scanner.log           実行ログ
  │
  └── requirements.txt          必要パッケージ一覧

================================================================
  使用 API（いずれも無料・APIキー不要）
================================================================
  DexScreener    https://api.dexscreener.com
                 Solana のプール一覧・MC・出来高・流動性を取得

  GeckoTerminal  https://api.geckoterminal.com/api/v2
                 ローソク足（OHLCV）データを取得
                 無料プランの上限: 30リクエスト/分

================================================================
